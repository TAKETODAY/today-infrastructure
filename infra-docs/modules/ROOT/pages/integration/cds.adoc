[[cds]]
= 类数据共享 (CDS)

类数据共享 (CDS) 是 JDK 的一项功能，有助于减少 Java 应用程序的启动时间和内存占用。

Infra 框架为 CDS 提供了特定支持，以便更轻松地为您的应用程序创建 CDS 归档。

[[cds-creation]]
== 创建 CDS 归档

CDS 分两个步骤工作：

1.  创建应用程序加载的类的列表。
2.  创建包含这些类的数据的归档。

Infra 框架提供了一个挂钩，通过使用 `infra.context.aot.AotApplicationContextInitializer` 来简化类列表的创建。
此类旨在用于应用程序的 AOT（提前）处理阶段，但它也可以用于执行应用程序并记录已加载的类。

要使用此功能，您需要在启动应用程序时设置 `infra.aot.enabled` 系统属性为 `true`，并启用 CDS 转储：

[source,bash]
----
java -Dinfra.aot.enabled=true -XX:ArchiveClassesAtExit=application.jsa -jar application.jar
----

这将启动您的应用程序，当您停止它时（例如，使用 `Ctrl+C`），JVM 将创建一个包含已加载类的 `application.jsa` 文件。

[[cds-usage]]
== 使用 CDS 归档

一旦有了 `application.jsa` 文件，就可以使用它来启动应用程序：

[source,bash]
----
java -XX:SharedArchiveFile=application.jsa -jar application.jar
----

JVM 将使用归档中的类数据，这应该会缩短启动时间。

[[cds-optimizations]]
== 优化

Infra 框架的 CDS 支持还包括一些优化，以确保尽可能多的类包含在归档中。
例如，它会急切地初始化某些组件，以确保它们的类被加载并包含在列表中。

这些优化是自动启用的，只要 `infra.aot.enabled` 系统属性设置为 `true`。
