[[mail]]
= 电子邮件

本节描述了如何使用 Infra 发送电子邮件。

[[mail-introduction]]
== 简介

库提供了一个用于发送电子邮件的实用程序库，该库将用户与底层邮件系统细节隔离开来，并负责代表客户端进行低级资源处理。

`infra.mail` 包是 Infra 电子邮件支持的根级包。
发送电子邮件的中心接口是 `MailSender` 接口。
`JavaMailSender` 扩展了 `MailSender` 以支持 MIME 消息，通常与 `MimeMessageHelper` 类一起使用，用于创建 `MimeMessage`。

[[mail-usage]]
== 用法

以下示例显示了如何使用 `JavaMailSenderImpl` 发送简单的电子邮件：

[source,java,indent=0,subs="verbatim,quotes"]
----
import infra.mail.SimpleMailMessage;
import infra.mail.javamail.JavaMailSenderImpl;

public class MailExample {

    public void sendMail() {
        JavaMailSenderImpl sender = new JavaMailSenderImpl();
        sender.setHost("mail.host.com");

        SimpleMailMessage message = new SimpleMailMessage();
        message.setFrom("user@host.com");
        message.setTo("user@otherhost.com");
        message.setSubject("Test");
        message.setText("This is a test");

        sender.send(message);
    }
}
----

此示例创建一个 `JavaMailSenderImpl` 实例，配置主机，创建 `SimpleMailMessage`，然后发送它。

[[mail-mime-messages]]
== MIME 消息

要发送带有附件或 HTML 内容的更复杂的电子邮件，可以使用 `MimeMessage`。
`JavaMailSender` 提供了 `createMimeMessage()` 方法来创建新消息。
为了简化 `MimeMessage` 的填充，Infra 提供了 `MimeMessageHelper` 类。

[source,java,indent=0,subs="verbatim,quotes"]
----
import jakarta.mail.internet.MimeMessage;
import infra.mail.javamail.JavaMailSender;
import infra.mail.javamail.MimeMessageHelper;

public class MimeMailExample {

    private JavaMailSender mailSender;

    public void sendMimeMail() {
        MimeMessage message = mailSender.createMimeMessage();
        MimeMessageHelper helper = new MimeMessageHelper(message, true);

        helper.setFrom("user@host.com");
        helper.setTo("user@otherhost.com");
        helper.setSubject("Test");
        helper.setText("<html><body><h1>This is a test</h1></body></html>", true);

        mailSender.send(message);
    }
}
----

[[mail-attachments]]
== 附件

`MimeMessageHelper` 也使添加附件变得容易：

[source,java,indent=0,subs="verbatim,quotes"]
----
import java.io.File;
import infra.core.io.FileSystemResource;

// ...

FileSystemResource file = new FileSystemResource(new File("attachment.jpg"));
helper.addAttachment("CoolImage.jpg", file);
----

[[mail-templates]]
== 电子邮件模板

Infra 不提供自己的模板引擎，但它很容易与第三方模板引擎（如 FreeMarker、Thymeleaf 或 Velocity）集成，以生成电子邮件内容。
您通常使用模板引擎生成 HTML 文本，然后将其传递给 `MimeMessageHelper.setText(text, true)`。
