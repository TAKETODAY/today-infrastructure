[[scheduling]]
= 任务执行和调度

Infra 框架分别为使用 `TaskExecutor` 和 `TaskScheduler` 接口的异步任务执行和任务调度提供了抽象。
Infra 还具有支持线程池或委托给应用服务器环境中的 CommonJ 的这些接口的实现。
最终，在公共接口背后使用这些实现抽象出了 Java SE 5、Java SE 6 和 Jakarta EE 环境之间的差异。

Infra 还具有用于调度任务的集成类，支持 `Timer`（JDK 的一部分）和 Quartz 调度器（https://www.quartz-scheduler.org/）。
你可以分别使用 `FactoryBean` 和可选的对 `Timer` 或 `Trigger` 实例的引用来设置这两个调度器。
此外，还有一个用于 Quartz 调度器和 `Timer` 的便捷类，允许你调用现有目标对象的方法（类似于正常的 `MethodInvokingFactoryBean` 操作）。

[[scheduling-task-executor]]
== Infra `TaskExecutor` 抽象

`Executor` 是 JDK 名称，用于线程池的概念。
“执行器”这个名字在命名上可能不那么直观，但实际上，它确实就是这么回事。
然而，由于它是 JDK 的一部分，Infra 使用了相同的术语，并定义了一个名为 `TaskExecutor` 的接口，该接口与 JDK 的 `Executor` 相同（实际上，它扩展了它）。
这个接口的主要目的是抽象出线程池的实现细节，让你的代码可以专注于任务执行，而不是线程管理。

[[scheduling-annotation-support]]
== 注解支持

Infra 提供了注解支持，用于异步方法执行和任务调度。

[[scheduling-enable-annotation-support]]
=== 启用调度注解

要启用 `@Scheduled` 和 `@Async` 注解的支持，你可以在你的 `@Configuration` 类中添加 `@EnableScheduling` 和 `@EnableAsync`：

[source,java,indent=0,subs="verbatim,quotes"]
----
@Configuration
@EnableAsync
@EnableScheduling
public class AppConfig {
}
----

[[scheduling-scheduled-annotation]]
=== @Scheduled 注解

你可以将 `@Scheduled` 注解添加到方法上，以定期的间隔运行它。

[source,java,indent=0,subs="verbatim,quotes"]
----
@Scheduled(fixedRate = 5000)
public void doSomething() {
    // 每 5 秒做一次
}
----

[[scheduling-async-annotation]]
=== @Async 注解

你可以将 `@Async` 注解添加到方法上，以便在单独的线程中异步调用它。

[source,java,indent=0,subs="verbatim,quotes"]
----
@Async
public void doSomethingAsync() {
    // 在单独的线程中运行
}
----

[[scheduling-cron-expression]]
== Cron 表达式

Infra 的调度支持还包括对 Cron 表达式的支持，允许你定义复杂的执行计划。

[source,java,indent=0,subs="verbatim,quotes"]
----
@Scheduled(cron = "0 0 * * * *")
public void doSomethingHourly() {
    // 每小时整点运行
}
----
