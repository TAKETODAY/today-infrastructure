[[beans-autowired-annotation-primary]]
= 使用 `@Primary` 或 `@Fallback` 微调基于注解的自动装配

由于按类型自动装配可能会导致多个候选者，因此通常需要对选择过程进行更多控制。
实现此目的的一种方法是使用 Infra `@Primary` 注解。
`@Primary` 表示当多个 bean 是自动装配到单值依赖项的候选者时，应优先考虑特定的 bean。
如果候选者中恰好存在一个主 bean，它将成为自动装配的值。

考虑以下配置，该配置将 `firstMovieCatalog` 定义为主 `MovieCatalog`：

[tabs]
======
Java::
+
[source,java,indent=0,subs="verbatim,quotes",role="primary"]
----
@Configuration
public class MovieConfiguration {

  @Bean
  @Primary
  public MovieCatalog firstMovieCatalog() { ... }

  @Bean
  public MovieCatalog secondMovieCatalog() { ... }

  // ...
}
----

======

或者，从 6.2 开始，有一个 `@Fallback` 注解，用于标记要注入的除常规 bean 之外的任何 bean。
如果只剩下一个常规 bean，它实际上也是主 bean：

[tabs]
======
Java::
+
[source,java,indent=0,subs="verbatim,quotes",role="primary"]
----
@Configuration
public class MovieConfiguration {

  @Bean
  public MovieCatalog firstMovieCatalog() { ... }

  @Bean
  @Fallback
  public MovieCatalog secondMovieCatalog() { ... }

  // ...
}
----

======

使用前面配置的两种变体，以下 `MovieRecommender` 将自动装配 `firstMovieCatalog`：

[tabs]
======
Java::
+
[source,java,indent=0,subs="verbatim,quotes",role="primary"]
----
public class MovieRecommender {

  @Autowired
  private MovieCatalog movieCatalog;

  // ...
}
----

======

相应的 bean 定义如下：

[source,xml,indent=0,subs="verbatim,quotes"]
----
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xmlns:context="http://www.springframework.org/schema/context"
  xsi:schemaLocation="http://www.springframework.org/schema/beans
    https://www.springframework.org/schema/beans/spring-beans.xsd
    http://www.springframework.org/schema/context
    https://www.springframework.org/schema/context/spring-context.xsd">

  <context:annotation-config/>

  <bean class="example.SimpleMovieCatalog" primary="true">
    <!-- 注入此 bean 所需的任何依赖项 -->
  </bean>

  <bean class="example.SimpleMovieCatalog">
    <!-- 注入此 bean 所需的任何依赖项 -->
  </bean>

  <bean id="movieRecommender" class="example.MovieRecommender"/>

</beans>
----
