
plugins {
  id "java-gradle-plugin"
//  id "com.gradle.plugin-publish" version "1.3.1"
}

description = "TODAY Infrastructure Applications Gradle Plugins"


dependencies {
  implementation(project(":today-core"))
  implementation(project(":infra-build:infra-app-loader"))
  implementation(project(":infra-build:infra-app-loader-tools"))

  optional "org.graalvm.buildtools:native-gradle-plugin"
  implementation 'org.apache.commons:commons-compress'
  implementation 'io.spring.gradle:dependency-management-plugin'

  testImplementation(project(":today-aop"))
  testImplementation(project(":today-core-aot"))
  testImplementation(project(":infra-app"))
  testImplementation(project(":today-test-support"))

  testImplementation("tools.jackson.core:jackson-databind")

  testImplementation("com.tngtech.archunit:archunit-junit5:0.22.0")
  testImplementation("org.apache.httpcomponents.client5:httpclient5")
  testImplementation("org.assertj:assertj-core")
  testImplementation("org.junit.jupiter:junit-jupiter")
  testImplementation("org.mockito:mockito-core")
  testImplementation("org.testcontainers:junit-jupiter")
  testImplementation("org.testcontainers:testcontainers")
  testImplementation 'org.jboss.logging:jboss-logging:3.5.3.Final'
  testImplementation("com.jayway.jsonpath:json-path")
  testImplementation("org.testcontainers:testcontainers")
  testImplementation("org.hamcrest:hamcrest")
  testImplementation("org.mockito:mockito-junit-jupiter")
  testImplementation("org.skyscreamer:jsonassert")
  testImplementation("net.java.dev.jna:jna-platform")
  testImplementation "commons-io:commons-io"
  testImplementation("org.tomlj:tomlj:1.0.0")
  testImplementation 'com.github.openjson:openjson:1.0.13'
}

gradlePlugin {
  automatedPublishing = true
  website = "https://github.com/TAKETODAY/today-infrastructure"
  vcsUrl = "https://github.com/TAKETODAY/today-infrastructure"
  plugins {
    infraPlugin {
      id = "infra.application"
      tags.set(['web', 'application'])
      displayName = "TODAY Infrastructure Applications Gradle Plugin"
      description = "TODAY Infrastructure Applications Gradle Plugin"
      implementationClass = "infra.gradle.plugin.InfraApplicationPlugin"
    }
    infraAotPlugin {
      id = "infra.application.aot"
      tags.set(['web', 'application', 'aot'])
      displayName = "TODAY Infrastructure Applications AOT Gradle Plugin"
      description = "TODAY Infrastructure Applications AOT Gradle Plugin"
      implementationClass = "infra.gradle.plugin.InfraApplicationAotPlugin"
    }
  }
}

tasks.named('test') {
  inputs.dir('src/docs/gradle').withPathSensitivity(PathSensitivity.RELATIVE).withPropertyName('buildScripts')
}

