plugins {
  id "java-gradle-plugin"
  // id "com.gradle.plugin-publish" version "1.2.0"
}

description = "TODAY Infrastructure Applications Gradle Plugins"

configurations.configureEach {
  resolutionStrategy {
    eachDependency { dependency ->
      // Downgrade Jackson as Gradle cannot cope with 2.15.0's multi-version
      // jar files with bytecode in META-INF/versions/19
      if (dependency.requested.group.startsWith("com.fasterxml.jackson")) {
        dependency.useVersion("2.14.2")
      }
    }
  }
}

dependencies {

  implementation(project(":today-core"))
  implementation(project(":today-test-support"))
  implementation(project(":infra-build:infra-app-loader"))
  implementation(project(":infra-build:infra-app-loader-tools"))
  implementation project(":infra-build:infra-buildpack-platform")
  implementation 'org.apache.commons:commons-compress:1.21'
  implementation 'io.spring.gradle:dependency-management-plugin:1.1.4'

  optional('org.graalvm.buildtools:native-gradle-plugin:0.9.28')

  testImplementation(project(":today-aop"))
  testImplementation(project(":today-framework"))
  testImplementation("com.tngtech.archunit:archunit-junit5:0.22.0")
  testImplementation("org.assertj:assertj-core")
  testImplementation("org.junit.jupiter:junit-jupiter")
  testImplementation("org.mockito:mockito-core")
  testImplementation("org.testcontainers:junit-jupiter")
  testImplementation("org.testcontainers:testcontainers")
}

gradlePlugin {
  website = "https://github.com/TAKETODAY/today-infrastructure"
  vcsUrl = "https://github.com/TAKETODAY/today-infrastructure"
  plugins {
    infraPlugin {
      id = "cn.taketoday.application"
      tags.set(['web', 'application'])
      displayName = "TODAY Infrastructure Applications Gradle Plugin"
      description = "TODAY Infrastructure Applications Gradle Plugin"
      implementationClass = "cn.taketoday.gradle.plugin.InfraApplicationPlugin"
    }
    infraAotPlugin {
      id = "cn.taketoday.application.aot"
      tags.set(['web', 'application', 'aot'])
      displayName = "TODAY Infrastructure Applications AOT Gradle Plugin"
      description = "TODAY Infrastructure Applications AOT Gradle Plugin"
      implementationClass = "cn.taketoday.gradle.plugin.InfraApplicationAotPlugin"
    }
  }
}

tasks.named('test') {
  inputs.dir('src/docs/gradle').withPathSensitivity(PathSensitivity.RELATIVE).withPropertyName('buildScripts')
}

